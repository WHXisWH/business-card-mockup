<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ºç¯‰æ¥­ç•Œå‘ã‘NFCé€£æºå‹DXãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="topScreen" class="screen active">
        <div class="header">
            <h1>æ¡ˆä»¶1 - DXãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </h1>
            <p>è§¦ã‚Œã‚‹ã€è¦‹ãˆã‚‹ã€ç¹‹ãŒã‚‹ã€‚å»ºç¯‰ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–°ã—ã„ã‚«ã‚¿ãƒ</p>
        </div>
        
        <div class="card">
            <h2>ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h2>
            <p>å„ç¨®ææ¡ˆè³‡æ–™ã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è³‡æ–™ãªã©ã‚’æ ¼ç´ã™ã‚‹ã‚¨ãƒªã‚¢ã§ã™ã€‚</p>
            <button class="btn" onclick="showScreen('documentScreen')">è³‡æ–™ã‚’è¦‹ã‚‹</button>
        </div>
        
        <div class="card">
            <h2>ğŸ—ï¸ BIM/3Dãƒ¢ãƒ‡ãƒ«ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h2>
            <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å»ºç¯‰ãƒ¢ãƒ‡ãƒ«ã‚’ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª3Dã§ä½“é¨“ã§ãã‚‹ã‚¨ãƒªã‚¢ã§ã™ã€‚</p>
            <button class="btn btn-red" onclick="showScreen('categoryScreen')">3Dãƒ¢ãƒ‡ãƒ«ã‚’è¦‹ã‚‹</button>
        </div>
    </div>

    <div id="documentScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <div class="header">
            <h1>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h1>
            <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£è³‡æ–™</p>
        </div>
        
        <div class="document-grid">
            <div class="document-item" onclick="showPdfViewer('ä¼šç¤¾æ¦‚è¦', 'pdfs/ä¼šç¤¾æ¦‚è¦.pdf')">
                <div class="document-icon">ğŸ¢</div>
                <h3>ä¼šç¤¾æ¦‚è¦</h3>
                <p>ä¼æ¥­æƒ…å ±</p>
            </div>
            <div class="document-item" onclick="showPdfViewer('ç’°å¢ƒèªè¨¼', 'pdfs/ç’°å¢ƒèªè¨¼.pdf')">
                <div class="document-icon">ğŸŒ±</div>
                <h3>ç’°å¢ƒèªè¨¼</h3>
                <p>ISOèªè¨¼ç­‰</p>
            </div>
            <div class="document-item" onclick="showPdfViewer('æ–½å·¥å®Ÿç¸¾', 'pdfs/æ–½å·¥å®Ÿç¸¾.pdf')">
                <div class="document-icon">ğŸ“ˆ</div>
                <h3>æ–½å·¥å®Ÿç¸¾</h3>
                <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¾‹</p>
            </div>
            <div class="document-item" onclick="showPdfViewer('ææ¡ˆæ›¸', 'pdfs/ææ¡ˆæ›¸.pdf')">
                <div class="document-icon">ğŸ“‹</div>
                <h3>ææ¡ˆæ›¸</h3>
                <p>åŸºæœ¬ææ¡ˆ</p>
            </div>
        </div>
    </div>

    <!-- PDF Viewer Screen (Replaces the four old ones) -->
    <div id="pdfViewerScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <div class="header"><h1 id="pdf-title">PDF Viewer</h1></div>
        <div class="pdf-viewer-controls">
            <button id="zoom-out" class="btn" title="ç¼©å°">âˆ’</button>
            <button id="zoom-in" class="btn" title="æ”¾å¤§">+</button>
            <button id="rotate-pdf" class="btn" title="æ—‹è½¬90Â°">âŸ²</button>
            <button id="prev-page" class="btn">â†</button>
            <span id="page-num"></span> / <span id="page-count"></span>
            <button id="next-page" class="btn">â†’</button>
            <button id="fit-mode-toggle" class="btn" title="é€‚åº”æ¨¡å¼">â›¶</button>
        </div>
        <div id="pdf-container" class="pdf-container">
            <div id="pdf-canvas-wrapper" class="pdf-canvas-wrapper">
                <canvas id="pdf-canvas"></canvas>
            </div>
        </div>
    </div>

    <div id="categoryScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <div class="header">
            <h1>BIM/3Dãƒ¢ãƒ‡ãƒ«ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h1>
            <p>ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³åˆ¥ãƒ¢ãƒ‡ãƒ«</p>
        </div>
        
        <div class="category-grid">
            <div class="card">
                <h2>ğŸš› ç‰©æµæ–½è¨­ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                <p>æ¬¡ä¸–ä»£ã®ç‰©æµãƒ‹ãƒ¼ã‚ºã«å¿œãˆã‚‹ã€é«˜æ©Ÿèƒ½ãªç‰©æµå€‰åº«ã®ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆã—ã¾ã™ã€‚</p>
                <button class="btn" onclick="showScreen('logisticsScreen')">ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹</button>
            </div>
            
            <div class="card">
                <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                <p>ãƒ‡ã‚¸ã‚¿ãƒ«ç¤¾ä¼šã®æ ¹å¹¹ã‚’æ”¯ãˆã‚‹ã€é«˜ä¿¡é ¼æ€§ãƒ»é«˜åŠ¹ç‡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆã—ã¾ã™ã€‚</p>
                <button class="btn btn-grey" onclick="showScreen('datacenterScreen')">ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹</button>
            </div>
        </div>
    </div>

    <div id="logisticsScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <div class="header">
            <h1>ç‰©æµæ–½è¨­ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <p>ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ©ãƒ³ä¸€è¦§</p>
        </div>
        
        <div class="plan-grid">
            <div class="plan-btn" onclick="showViewer('ç‰©æµæ–½è¨­ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ - Plan A', 'å»¶åºŠé¢ç©: 5,000ã¡ | æ§‹é€ : é‰„éª¨é€  | ç‰¹å¾´: è‡ªå‹•åŒ–å¯¾å¿œ')">
                Plan A - å°è¦æ¨¡è‡ªå‹•åŒ–å€‰åº«
            </div>
            <div class="plan-btn" onclick="showViewer('ç‰©æµæ–½è¨­ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ - Plan B', 'å»¶åºŠé¢ç©: 12,000ã¡ | æ§‹é€ : é‰„éª¨é€  | ç‰¹å¾´: å¤šæ¸©åº¦å¸¯å¯¾å¿œ')">
                Plan B - ä¸­è¦æ¨¡é…é€ã‚»ãƒ³ã‚¿ãƒ¼
            </div>
            <div class="plan-btn" onclick="showViewer('ç‰©æµæ–½è¨­ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ - Plan C', 'å»¶åºŠé¢ç©: 25,000ã¡ | æ§‹é€ : é‰„éª¨é€  | ç‰¹å¾´: æœ€æ–°IoTæŠ€è¡“')">
                Plan C - å¤§è¦æ¨¡ç‰©æµãƒãƒ–
            </div>
        </div>
    </div>

    <div id="datacenterScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <div class="header">
            <h1>ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <p>ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ©ãƒ³ä¸€è¦§</p>
        </div>
        
        <div class="plan-grid">
            <div class="plan-btn" onclick="showViewer('ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ - Plan A', 'å»¶åºŠé¢ç©: 3,000ã¡ | ï¿½ï¿½é€ : RCé€  | ç‰¹å¾´: ã‚¨ãƒƒã‚¸ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯¾å¿œ')">
                Plan A - ã‚¨ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼
            </div>
            <div class="plan-btn" onclick="showViewer('ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ - Plan B', 'å»¶åºŠé¢ç©: 8,000ã¡ | æ§‹é€ : RCé€  | ç‰¹å¾´: é«˜å†—é•·æ€§è¨­è¨ˆ')">
                Plan B - ä¼æ¥­å‘ã‘ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼
            </div>
            <div class="plan-btn" onclick="showViewer('ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ - Plan C', 'å»¶åºŠé¢ç©: 20,000ã¡ | æ§‹é€ : RCé€  | ç‰¹å¾´: ãƒã‚¤ãƒ‘ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«å¯¾å¿œ')">
                Plan C - ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼
            </div>
        </div>
    </div>

    <div id="viewerScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <button class="nft-btn" onclick="showScreen('nftScreen')">ã“ã®NFTã‚’å—ã‘å–ã‚‹ ğŸ</button>
        
        <div class="viewer-container">
            <model-viewer 
                id="modelViewer"
                src="building-model.glb"
                ar 
                auto-rotate 
                camera-controls 
                shadow-intensity="1"
                environment-image="neutral"
                alt="3Då»ºç¯‰ãƒ¢ãƒ‡ãƒ«">
            </model-viewer>
            
            <div class="model-info">
                <h3 id="modelTitle">3Dãƒ¢ãƒ‡ãƒ«</h3>
                <p id="modelDescription">ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°æƒ…å ±</p>
            </div>
        </div>
    </div>

    <div id="nftScreen" class="screen">
        <button class="back-btn" onclick="goBack()">â†</button>
        <div class="nft-marketplace">
            <div class="header">
                <h1>ğŸ NFTãƒ‡ã‚¸ã‚¿ãƒ«ã‚®ãƒ•ãƒˆ</h1>
                <p>ãƒ‡ã‚¸ã‚¿ãƒ«å»ºç¯‰ã‚¢ã‚»ãƒƒãƒˆã‚’ç„¡æ–™ã§å—ã‘å–ã‚Š</p>
            </div>
            
            <div class="nft-card">
                <h2 id="nftTitle">å»ºç¯‰3Dãƒ¢ãƒ‡ãƒ« NFT</h2>
                <p>ã“ã®3Dãƒ¢ãƒ‡ãƒ«ã®åˆ©ç”¨æ¨©ãŠã‚ˆã³æ‰€æœ‰æ¨©ã‚’NFTã¨ã—ã¦ç„¡æ–™ã§å—ã‘å–ã‚Œã¾ã™ã€‚</p>
                
                <div class="nft-price">ğŸ ç„¡æ–™è´ˆå‘ˆ</div>
                
                <div style="margin: 20px 0;">
                    <h3>å—ã‘å–ã‚Œã‚‹æ¨©åˆ©:</h3>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>3Dãƒ¢ãƒ‡ãƒ«ã®å•†ç”¨åˆ©ç”¨æ¨©</li>
                        <li>è¨­è¨ˆå›³é¢ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¨©</li>
                        <li>æŠ€è¡“ä»•æ§˜æ›¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©</li>
                        <li>å°†æ¥ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç‰ˆã®å„ªå…ˆå…¥æ‰‹æ¨©</li>
                    </ul>
                </div>
                
                <button class="btn purchase-btn" onclick="receiveNFT()">
                    ğŸ ä»Šã™ãå—ã‘å–ã‚‹
                </button>
                
                <div style="margin-top: 20px; font-size: 14px; color: #666;">
                    <p>â€» å—ã‘å–ã‚Šã«ã¯MetaMaskãªã©ã®Web3ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒå¿…è¦ã§ã™</p>
                    <p>â€» ã‚¬ã‚¹ä»£ã®ã¿ãŠå®¢æ§˜è² æ‹…ã¨ãªã‚Šã¾ã™</p>
                </div>
            </div>
            
            <div class="nft-card">
                <h3>ğŸ”— ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³è©³ç´°</h3>
                <p><strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯:</strong> Ethereum Mainnet</p>
                <p><strong>ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ:</strong> 0x1234...abcd</p>
                <p><strong>ãƒˆãƒ¼ã‚¯ãƒ³è¦æ ¼:</strong> ERC-721</p>
                <p><strong>ç™ºè¡Œè€…:</strong> æˆ¸ç”°å»ºè¨­æ ªå¼ä¼šç¤¾</p>
            </div>
        </div>
    </div>

    <script>
        let screenHistory = ['topScreen'];

        // PDF.js state
        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let fitMode = 'width'; // 'width' or 'page'
        let currentScale = 1;
        let manualScale = 1;
        let rotation = 0;
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');
        const canvasWrapper = document.getElementById('pdf-canvas-wrapper');
        
        // Pan navigation state
        let isPanning = false;
        let startX, startY, scrollStartX, scrollStartY;

        // Set worker source
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then(function(page) {
                const container = document.getElementById('pdf-container');
                const viewport = page.getViewport({ scale: 1, rotation });
                
                // Calculate base scale based on fit mode
                let baseScale;
                if (fitMode === 'width') {
                    baseScale = (container.clientWidth - 40) / viewport.width; // 40px for padding
                } else { // 'page'
                    const scaleX = (container.clientWidth - 40) / viewport.width;
                    const scaleY = (container.clientHeight - 40) / viewport.height;
                    baseScale = Math.min(scaleX, scaleY);
                }

                // Apply manual zoom
                const finalScale = baseScale * manualScale;
                currentScale = finalScale;

                // For mobile optimization, ensure minimum readable size
                const minScale = Math.max(baseScale * 0.8, 0.5);
                const maxScale = baseScale * 5;
                const clampedScale = Math.max(minScale, Math.min(maxScale, finalScale));

                const devicePixelRatio = window.devicePixelRatio || 1;
                const scaledViewport = page.getViewport({ scale: clampedScale * devicePixelRatio, rotation });

                canvas.height = scaledViewport.height;
                canvas.width = scaledViewport.width;
                canvas.style.height = `${scaledViewport.height / devicePixelRatio}px`;
                canvas.style.width = `${scaledViewport.width / devicePixelRatio}px`;

                // Center canvas if smaller than container
                const canvasDisplayWidth = scaledViewport.width / devicePixelRatio;
                const canvasDisplayHeight = scaledViewport.height / devicePixelRatio;
                
                if (canvasDisplayWidth < container.clientWidth) {
                    canvas.style.marginLeft = `${(container.clientWidth - canvasDisplayWidth) / 2}px`;
                } else {
                    canvas.style.marginLeft = '0px';
                }
                
                if (canvasDisplayHeight < container.clientHeight) {
                    canvas.style.marginTop = `${(container.clientHeight - canvasDisplayHeight) / 2}px`;
                } else {
                    canvas.style.marginTop = '0px';
                }

                const renderContext = {
                    canvasContext: ctx,
                    viewport: scaledViewport,
                    renderInteractiveForms: false,
                };
                const renderTask = page.render(renderContext);

                renderTask.promise.then(function() {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });

            document.getElementById('page-num').textContent = num;
        }

        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        function onPrevPage() {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        }
        document.getElementById('prev-page').addEventListener('click', onPrevPage);

        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        }
        document.getElementById('next-page').addEventListener('click', onNextPage);

        function toggleFitMode() {
            fitMode = fitMode === 'width' ? 'page' : 'width';
            manualScale = 1; // Reset manual zoom when changing fit mode
            console.log('Toggled fit mode to:', fitMode);
            if (pdfDoc) {
                queueRenderPage(pageNum);
            }
        }
        document.getElementById('fit-mode-toggle').addEventListener('click', toggleFitMode);

        // Zoom functions
        function zoomIn() {
            manualScale = Math.min(manualScale * 1.2, 5);
            if (pdfDoc) {
                queueRenderPage(pageNum);
            }
        }
        document.getElementById('zoom-in').addEventListener('click', zoomIn);

        function zoomOut() {
            manualScale = Math.max(manualScale / 1.2, 0.5);
            if (pdfDoc) {
                queueRenderPage(pageNum);
            }
        }
        document.getElementById('zoom-out').addEventListener('click', zoomOut);

        // Rotation function
        function rotatePdf() {
            rotation = (rotation + 90) % 360;
            if (pdfDoc) {
                queueRenderPage(pageNum);
            }
        }
        document.getElementById('rotate-pdf').addEventListener('click', rotatePdf);

        // Pan navigation for mobile
        function setupPanNavigation() {
            // Mouse events
            canvasWrapper.addEventListener('mousedown', function(e) {
                isPanning = true;
                startX = e.clientX;
                startY = e.clientY;
                scrollStartX = canvasWrapper.scrollLeft;
                scrollStartY = canvasWrapper.scrollTop;
                canvasWrapper.style.cursor = 'grabbing';
                e.preventDefault();
            });

            document.addEventListener('mousemove', function(e) {
                if (!isPanning) return;
                const dx = startX - e.clientX;
                const dy = startY - e.clientY;
                canvasWrapper.scrollLeft = scrollStartX + dx;
                canvasWrapper.scrollTop = scrollStartY + dy;
                e.preventDefault();
            });

            document.addEventListener('mouseup', function(e) {
                isPanning = false;
                canvasWrapper.style.cursor = 'grab';
            });

            // Touch events for mobile
            canvasWrapper.addEventListener('touchstart', function(e) {
                if (e.touches.length === 1) {
                    isPanning = true;
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                    scrollStartX = canvasWrapper.scrollLeft;
                    scrollStartY = canvasWrapper.scrollTop;
                    e.preventDefault();
                }
            });

            canvasWrapper.addEventListener('touchmove', function(e) {
                if (isPanning && e.touches.length === 1) {
                    const dx = startX - e.touches[0].clientX;
                    const dy = startY - e.touches[0].clientY;
                    canvasWrapper.scrollLeft = scrollStartX + dx;
                    canvasWrapper.scrollTop = scrollStartY + dy;
                    e.preventDefault();
                }
            });

            canvasWrapper.addEventListener('touchend', function(e) {
                isPanning = false;
            });

            // Pinch zoom for mobile
            let initialDistance = 0;
            let initialScale = 1;

            canvasWrapper.addEventListener('touchstart', function(e) {
                if (e.touches.length === 2) {
                    initialDistance = getTouchDistance(e.touches[0], e.touches[1]);
                    initialScale = manualScale;
                    e.preventDefault();
                }
            });

            canvasWrapper.addEventListener('touchmove', function(e) {
                if (e.touches.length === 2) {
                    const currentDistance = getTouchDistance(e.touches[0], e.touches[1]);
                    const scaleChange = currentDistance / initialDistance;
                    manualScale = Math.max(0.5, Math.min(5, initialScale * scaleChange));
                    queueRenderPage(pageNum);
                    e.preventDefault();
                }
            });
        }

        function getTouchDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function showScreen(screenId) {
            console.log('Attempting to show screen:', screenId);
            if (screenId === 'topScreen') {
                screenHistory = ['topScreen'];
            } else {
                if (screenHistory[screenHistory.length - 1] !== screenId) {
                    screenHistory.push(screenId);
                }
            }

            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            console.log('Screen shown:', screenId);
            console.log('Current screen history:', screenHistory);
        }

        function showPdfViewer(title, url) {
            console.log('Attempting to show PDF viewer for:', title, 'with URL:', url);
            document.getElementById('pdf-title').textContent = title;
            
            // Reset all PDF viewer state on new PDF
            fitMode = 'width';
            manualScale = 1;
            rotation = 0;
            currentScale = 1;
            
            pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById('page-count').textContent = pdfDoc.numPages;
                pageNum = 1;
                
                // Determine optimal initial settings based on PDF characteristics
                pdfDoc.getPage(1).then(function(page) {
                    const viewport = page.getViewport({ scale: 1 });
                    const aspectRatio = viewport.width / viewport.height;
                    const isMobile = window.innerWidth < 768;
                    const isLandscapePdf = aspectRatio > 1.4;
                    const isPortraitPdf = aspectRatio < 0.8;
                    
                    // Smart initial settings for mobile
                    if (isMobile) {
                        if (isLandscapePdf) {
                            // For landscape PDFs like A3, start with page fit mode for overview
                            fitMode = 'page';
                            console.log('Landscape PDF detected - using page fit mode for overview');
                        } else if (isPortraitPdf) {
                            // For portrait PDFs like A4, width fit is usually better
                            fitMode = 'width';
                            console.log('Portrait PDF detected - using width fit mode');
                        }
                        
                        // Adjust initial manual scale for better readability on mobile
                        if (isLandscapePdf && viewport.width > 1000) {
                            manualScale = 1.3; // Slightly larger for wide PDFs
                        }
                    }
                    
                    renderPage(pageNum);
                });
                
                // Setup pan navigation after DOM is ready
                setTimeout(setupPanNavigation, 100);
            });

            showScreen('pdfViewerScreen');
            console.log('PDF viewer setup complete.');
        }
        
        function showViewer(title, description) {
            console.log('Attempting to show viewer with title:', title, 'and description:', description);
            document.getElementById('modelTitle').textContent = title;
            document.getElementById('modelDescription').textContent = description;
            document.getElementById('nftTitle').textContent = title + ' NFT';
            showScreen('viewerScreen');
            console.log('Viewer setup complete.');
        }
        
        function goBack() {
            console.log('Attempting to go back. Current history:', screenHistory);
            if (screenHistory.length > 1) {
                const currentScreenId = screenHistory[screenHistory.length - 1];
                screenHistory.pop();
                const targetScreenId = screenHistory[screenHistory.length - 1];
                
                if (currentScreenId === 'pdfViewerScreen' && pdfDoc) {
                    if (pdfDoc) {
                       pdfDoc.destroy();
                    }
                    pdfDoc = null;
                    const context = canvas.getContext('2d');
                    context.clearRect(0, 0, canvas.width, canvas.height);
                }

                const screens = document.querySelectorAll('.screen');
                screens.forEach(screen => screen.classList.remove('active'));
                document.getElementById(targetScreenId).classList.add('active');
                console.log('Navigated back to:', targetScreenId);
            } else {
                showScreen('topScreen');
                console.log('Navigated to top screen as history is empty.');
            }
            console.log('Updated screen history:', screenHistory);
        }
        
        function receiveNFT() {
            alert(`ğŸ NFTã‚®ãƒ•ãƒˆå—ã‘å–ã‚Šæ©Ÿèƒ½ã¯ãƒ¢ãƒƒã‚¯ã§ã™ã€‚

å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€Web3ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã¨ã®é€£æºã«ã‚ˆã‚Šã€ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§ã®NFTè»¢é€å‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

å—ã‘å–ã‚Šå¾Œã¯ã€ãŠå®¢æ§˜ã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«å»ºç¯‰3Dãƒ¢ãƒ‡ãƒ«ã®NFTãŒç„¡æ–™ã§è»¢é€ã•ã‚Œã€é–¢é€£ã™ã‚‹åˆ©ç”¨æ¨©ã‚„æ‰€æœ‰æ¨©ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

æˆ¸ç”°å»ºè¨­ã‹ã‚‰ã®ãƒ‡ã‚¸ã‚¿ãƒ«ã‚®ãƒ•ãƒˆã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼`);
        }
        
        // NFCæ©Ÿèƒ½ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        if ('serviceWorker' in navigator) {
            console.log('NFCé€£æºå‹DXãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒèµ·å‹•ã—ã¾ã—ãŸ');
        }
    </script>
</body>
</html>
