<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="建築業界向けNFC連携型DXプラットフォーム - 触れる、見える、繋がる。建築コミュニケーションの新しいカタチ">
    <meta name="keywords" content="建築,NFC,DX,プラットフォーム,3D,BIM,PDF,建設">
    <meta name="author" content="戸田建設株式会社">
    
    <!-- PWA対応 -->
    <meta name="theme-color" content="#87CEEB">
    <meta name="application-name" content="NFC-DX Platform">
    
    <title>建築業界向けNFC連携型DXプラットフォーム</title>
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//ajax.googleapis.com">
    
    <!-- Resource Preloads -->
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="preload" href="js/main.js" as="script">
    <link rel="preload" href="public/building-model.glb" as="fetch" type="model/gltf-binary" crossorigin="anonymous">
    
    <!-- キャッシュ無効化付きクリティカルCSS -->
    <link rel="stylesheet" href="css/styles.css?v=1.2.0">
    
    <!-- External Libraries -->
    <script 
        src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"
        crossorigin="anonymous"
        defer>
    </script>
    
    <script 
        type="module" 
        src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"
        onerror="console.warn('Model Viewer failed to load from CDN')">
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js?v=1.2.0')
                    .then(registration => {
                        console.log('SW registered');
                        // 更新検出時の処理
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // 静かに新バージョンを有効化
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                }
                            });
                        });
                        // Service Worker更新をチェック
                        registration.update();
                    })
                    .catch(error => console.log('SW registration failed'));
                    
                // Service Workerからのメッセージをリッスン
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    // 新しいバージョンがアクティブになった際の静かな処理
                    console.log('New version activated');
                });
            });
        }
    </script>
</head>
<body>
    <!-- メイン画面 -->
    <div id="topScreen" class="screen active">
        <div class="header">
            <h1>案件1 - DXプラットフォーム</h1>
            <p>触れる、見える、繋がる。建築コミュニケーションの新しいカタチ</p>
        </div>
        
        <div class="card">
            <h2>📄 ドキュメントライブラリ</h2>
            <p>各種提案資料、プロモーション資料などを格納するエリアです。</p>
            <button class="btn" data-target="documentScreen">資料を見る</button>
        </div>
        
        <div class="card">
            <h2>🏗️ BIM/3Dモデルギャラリー</h2>
            <p>プロジェクトの建築モデルを、インタラクティブな3Dで体験できるエリアです。</p>
            <button class="btn btn-red" data-target="categoryScreen">3Dモデルを見る</button>
        </div>
    </div>

    <!-- ドキュメントライブラリ画面 -->
    <div id="documentScreen" class="screen">
        <button class="back-btn">←</button>
        <div class="header">
            <h1>ドキュメントライブラリ</h1>
            <p>プロジェクト関連資料</p>
        </div>
        
        <div class="document-grid">
            <div class="document-item" data-pdf-title="会社概要" data-pdf-url="pdfs/会社概要.pdf">
                <div class="document-icon">🏢</div>
                <h3>会社概要</h3>
                <p>企業情報</p>
            </div>
            <div class="document-item" data-pdf-title="環境認証" data-pdf-url="pdfs/環境認証.pdf">
                <div class="document-icon">🌱</div>
                <h3>環境認証</h3>
                <p>ISO認証等</p>
            </div>
            <div class="document-item" data-pdf-title="施工実績" data-pdf-url="pdfs/施工実績.pdf">
                <div class="document-icon">📈</div>
                <h3>施工実績</h3>
                <p>プロジェクト例</p>
            </div>
            <div class="document-item" data-pdf-title="提案書" data-pdf-url="pdfs/提案書.pdf">
                <div class="document-icon">📋</div>
                <h3>提案書</h3>
                <p>基本提案</p>
            </div>
        </div>
    </div>

    <!-- PDF ビューア画面 -->
    <div id="pdfViewerScreen" class="screen">
        <button class="back-btn">←</button>
        <div class="header"><h1 id="pdf-title">PDF Viewer</h1></div>
        <div class="pdf-viewer-controls">
            <button id="zoom-out" class="btn" title="縮小" aria-label="ズームアウト">−</button>
            <button id="zoom-in" class="btn" title="拡大" aria-label="ズームイン">+</button>
            <button id="rotate-pdf" class="btn" title="90度回転" aria-label="回転">⟲</button>
            <button id="prev-page" class="btn" aria-label="前のページ">←</button>
            <span id="page-num"></span> / <span id="page-count"></span>
            <button id="next-page" class="btn" aria-label="次のページ">→</button>
            <button id="fullscreen-toggle" class="btn" title="全画面表示" aria-label="全画面">⤴</button>
        </div>
        <div id="pdf-container" class="pdf-container">
            <div id="pdf-canvas-wrapper" class="pdf-canvas-wrapper">
                <canvas id="pdf-canvas" aria-label="PDF表示エリア"></canvas>
            </div>
        </div>
    </div>

    <!-- カテゴリ選択画面 -->
    <div id="categoryScreen" class="screen">
        <button class="back-btn">←</button>
        <div class="header">
            <h1>BIM/3Dモデルギャラリー</h1>
            <p>ソリューション別モデル</p>
        </div>
        
        <div class="category-grid">
            <div class="card">
                <h2>🚛 物流施設ソリューション</h2>
                <p>次世代の物流ニーズに応える、高機能な物流倉庫のモデルプランを提案します。</p>
                <button class="btn" data-target="logisticsScreen">プランを見る</button>
            </div>
            
            <div class="card">
                <h2>💾 データセンターソリューション</h2>
                <p>デジタル社会の根幹を支える、高信頼性・高効率なデータセンターのモデルプランを提案します。</p>
                <button class="btn btn-grey" data-target="datacenterScreen">プランを見る</button>
            </div>
        </div>
    </div>

    <!-- 物流施設画面 -->
    <div id="logisticsScreen" class="screen">
        <button class="back-btn">←</button>
        <div class="header">
            <h1>物流施設ソリューション</h1>
            <p>モデルプラン一覧</p>
        </div>
        
        <div class="plan-grid">
            <div class="plan-btn" 
                 data-model-src="public/warehouse_logistics_platform.glb"
                 data-model-title="ドック型物流センター" 
                 data-model-desc="接車ドックで効率的に荷捌きできる物流拠点">
                ドック型物流センター
            </div>
            <div class="plan-btn" 
                 data-model-src="public/souko_SideRampWay.glb"
                 data-model-title="ランプウェイ式物流センター" 
                 data-model-desc="片側ランプで各階へ直接搬入可能な物流拠点">
                ランプウェイ式物流センター
            </div>
            <div class="plan-btn" 
                 data-model-src="public/DoubleRamp.glb"
                 data-model-title="ダブルランプウェイ式物流センター" 
                 data-model-desc="両側ランプで大量車両が効率往来できる大規模拠点">
                ダブルランプウェイ式物流センター
            </div>
            <div class="plan-btn" 
                 data-model-src="public/dryWearhouse.glb"
                 data-model-title="ドライ倉庫レイアウト" 
                 data-model-desc="ドライ貨物専用の温湿度管理された保管施設">
                ドライ倉庫レイアウト
            </div>
        </div>
    </div>

    <!-- データセンター画面 -->
    <div id="datacenterScreen" class="screen">
        <button class="back-btn">←</button>
        <div class="header">
            <h1>データセンターソリューション</h1>
            <p>モデルプラン一覧</p>
        </div>
        
        <div class="plan-grid">
            <div class="plan-btn" 
                 data-model-src="public/DataCenter_AirCooling.glb"
                 data-model-title="空冷方式" 
                 data-model-desc="ホットアイル／コールドアイル方式で空気冷却するデータセンター">
                空冷方式
            </div>
            <div class="plan-btn" 
                 data-model-src="public/DLCHall.glb"
                 data-model-title="DLC方式" 
                 data-model-desc="コールドプレートなどを用いて液体をサーバー部品に直接接触させ熱を除去する。">
                DLC方式
            </div>
            <div class="plan-btn" 
                 data-model-src="public/LiquidHall.glb"
                 data-model-title="液浸方式" 
                 data-model-desc="サーバー全体を誘電体液に浸漬し、大量の熱を効率的に吸収・排出する。">
                液浸方式
            </div>
        </div>
    </div>

    <!-- 3Dモデルビューア画面 -->
    <div id="viewerScreen" class="screen">
        <button class="back-btn">←</button>
        <button class="nft-btn btn-architect-dao" data-target="nftScreen">
            ArchitectDAO で NFT を受け取る 🎁
        </button>
        
        <div class="viewer-container">
            <model-viewer 
                id="modelViewer"
                src="public/building-model.glb"
                auto-rotate 
                camera-controls 
                loading="eager"
                reveal="auto"
                alt="3D建築モデル"
                style="width: 100%; height: 400px; background-color: #f0f0f0;">
                <div slot="progress-bar" class="progress-bar">
                    <div class="update-bar"></div>
                </div>
                <div slot="error">
                    <p>モデルの読み込みに失敗しました</p>
                </div>
            </model-viewer>
            
            <div class="model-info">
                <h3 id="modelTitle">3Dモデル</h3>
                <p id="modelDescription">モデルの詳細情報</p>
            </div>
        </div>
    </div>

    <!-- NFT画面 -->
    <div id="nftScreen" class="screen">
        <button class="back-btn">←</button>
        <div class="nft-marketplace">
            <div class="header">
                <h1>🎁 NFTデジタルギフト</h1>
                <p>デジタル建築アセットを無料で受け取り</p>
            </div>
            
            <div class="nft-card">
                <h2 id="nftTitle">建築3Dモデル NFT</h2>
                <p>この3Dモデルの利用権および所有権をArchitectDAO プラットフォームでNFTとして無料で受け取れます。</p>
                
                <div class="nft-price">🎁 無料贈呈 via ArchitectDAO</div>
                
                <div style="margin: 20px 0;">
                    <h3>受け取れる権利:</h3>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>✅ 3Dモデルの商用利用権</li>
                        <li>✅ 設計図面のダウンロード権</li>
                        <li>✅ 技術仕様書へのアクセス権</li>
                        <li>✅ 将来のアップデート版の優先入手権</li>
                    </ul>
                </div>
                
                <button class="btn purchase-btn btn-architect-dao" id="receiveNftBtn">
                    🚀 ArchitectDAO でNFTを受け取る
                </button>
                
                <div style="margin-top: 20px; font-size: 14px; color: #666;">
                    <p>🔗 Nero Chain 上でNFTとしてミント（発行）されます</p>
                    <p>💼 ArchitectDAO プラットフォームに移動します</p>
                    <p>🎯 Web3ウォレットでの署名が必要です</p>
                </div>
            </div>
            
            <div class="nft-card">
                <h3>🏗️ ArchitectDAO について</h3>
                <p><strong>プラットフォーム:</strong> 建築師向けNFTマーケットプレース</p>
                <p><strong>ブロックチェーン:</strong> Nero Chain (EVM互換)</p>
                <p><strong>トークン規格:</strong> ERC-721</p>
                <p><strong>パートナー:</strong> 戸田建設株式会社</p>
                <p><strong>特徴:</strong> ガスレス取引・高速処理・低コスト</p>
            </div>
        </div>
    </div>

    <!-- PDF全画面オーバーレイ -->
    <div id="pdf-fullscreen-overlay" class="pdf-fullscreen-overlay">
        <div class="pdf-fullscreen-container">
            <div class="pdf-fullscreen-controls">
                <button id="fs-zoom-out" class="btn" title="縮小" aria-label="ズームアウト">−</button>
                <button id="fs-zoom-in" class="btn" title="拡大" aria-label="ズームイン">+</button>
                <button id="fs-rotate-pdf" class="btn" title="90度回転" aria-label="回転">⟲</button>
                <button id="fs-prev-page" class="btn" aria-label="前のページ">←</button>
                <span id="fs-page-num"></span> / <span id="fs-page-count"></span>
                <button id="fs-next-page" class="btn" aria-label="次のページ">→</button>
                <button id="exit-fullscreen" class="btn" title="全画面終了" aria-label="終了">✕</button>
            </div>
            <div class="pdf-fullscreen-viewer">
                <canvas id="pdf-fullscreen-canvas" class="pdf-fullscreen-canvas" aria-label="PDF全画面表示エリア"></canvas>
            </div>
        </div>
    </div>

    <!-- NFTデータ管理（キャッシュ無効化付き） -->
    <script src="js/nft-data.js?v=1.2.0"></script>
    
    <!-- メインJavaScript（キャッシュ無効化付き） -->
    <script src="js/main.js?v=1.2.0" defer></script>
    
    <!-- 構造化データ -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "NFC連携型DXプラットフォーム",
        "description": "建築業界向けNFC連携型DXプラットフォーム",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "JPY"
        },
        "author": {
            "@type": "Organization",
            "name": "戸田建設株式会社"
        }
    }
    </script>
</body>
</html>